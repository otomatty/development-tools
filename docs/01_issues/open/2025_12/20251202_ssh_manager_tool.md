# SSH Manager ツールの実装

## 概要

開発者の開発体験を向上させるため、SSH 接続を簡単に行えるツールを実装する。
ローカル PC 同士でのファイル転送やサーバーへのファイルアップロードを主なユースケースとする。

## 背景・目的

- 開発者が SSH 接続を行う際、ターミナルでのコマンド入力や`~/.ssh/config`の手動編集が必要
- SSH 鍵の管理が煩雑になりがち
- ファイル転送時に SCP コマンドの記法を覚える必要がある

これらの課題を GUI ツールで解決し、SSH 接続・ファイル転送の作業効率を向上させる。

## ユースケース

### UC-1: ローカル PC 同士でのファイル転送

- 同一ネットワーク内の別 PC にファイルを送信/受信
- 例: Mac から Windows へ、メイン PC から開発用サブ PC へ

### UC-2: サーバーへのファイルアップロード

- VPS やクラウドインスタンスにデプロイ用ファイルをアップロード
- 例: EC2 やさくら VPS への設定ファイル・ビルド成果物の転送

## 機能要件

### F-1: SSH Config 管理（GUI）

`~/.ssh/config` を GUI で直感的に編集する機能

| 項目               | 説明                         | 必須 |
| ------------------ | ---------------------------- | ---- |
| Host（エイリアス） | 接続名（例: `my-server`）    | ✅   |
| HostName           | 実際のホスト名/IP アドレス   | ✅   |
| User               | ログインユーザー名           | ✅   |
| Port               | ポート番号（デフォルト: 22） |      |
| IdentityFile       | 使用する SSH 鍵のパス        |      |
| ProxyJump          | 踏み台サーバー設定           |      |
| その他オプション   | ForwardAgent, Compression 等 |      |

**詳細要件:**

- [ ] 既存の `~/.ssh/config` の読み込み・パース
- [ ] エントリの追加・編集・削除
- [ ] 設定のバリデーション（必須項目チェック）
- [ ] 変更のプレビュー（差分表示）
- [ ] バックアップ作成（編集前に自動バックアップ）
- [ ] 設定ファイルのシンタックスハイライト表示

### F-2: SSH キー管理

| 機能             | 説明                                         | 優先度 |
| ---------------- | -------------------------------------------- | ------ |
| 鍵一覧表示       | `~/.ssh/` 内の鍵ファイルを一覧表示           | 高     |
| 鍵の生成         | RSA/Ed25519 等の新規鍵ペア生成               | 高     |
| 公開鍵のコピー   | ワンクリックで公開鍵をクリップボードにコピー | 高     |
| 鍵の詳細表示     | フィンガープリント、作成日、コメント等       | 中     |
| 鍵のインポート   | 外部から鍵ファイルをインポート               | 中     |
| 鍵の削除         | 不要な鍵の削除（確認ダイアログ付き）         | 中     |
| パスフレーズ変更 | 既存鍵のパスフレーズ変更                     | 低     |

### F-3: クイック接続

| 機能             | 説明                                               | 優先度 |
| ---------------- | -------------------------------------------------- | ------ |
| 接続先一覧       | SSH Config から読み込んだ接続先をカード/リスト表示 | 高     |
| ワンクリック接続 | クリックで即座に接続開始                           | 高     |
| 最近の接続       | 接続履歴を表示                                     | 高     |
| お気に入り       | よく使う接続先をピン留め                           | 中     |
| 検索・フィルタ   | 接続先の検索                                       | 中     |
| グループ化       | プロジェクトや環境（本番/開発）でグループ分け      | 低     |

### F-4: ターミナル統合

| 機能           | 説明                                       | 優先度 |
| -------------- | ------------------------------------------ | ------ |
| 内蔵ターミナル | アプリ内で SSH セッションを開く            | 高     |
| マルチタブ     | 複数の SSH セッションをタブで管理          | 高     |
| コマンド履歴   | 過去に実行したコマンドの履歴               | 中     |
| 分割ビュー     | 画面分割で複数セッションを同時表示         | 低     |
| スニペット     | よく使うコマンドを登録してワンクリック実行 | 低     |

### F-5: ファイル転送（SFTP）

| 機能              | 説明                                      | 優先度 |
| ----------------- | ----------------------------------------- | ------ |
| デュアルペイン    | ローカル/リモートをサイドバイサイドで表示 | 高     |
| ドラッグ&ドロップ | ファイルをドラッグして転送                | 高     |
| 進捗表示          | 転送の進捗をプログレスバーで表示          | 高     |
| 転送キュー        | 複数ファイルの転送をキュー管理            | 中     |
| 権限変更          | リモートファイルのパーミッション変更      | 中     |
| 同期機能          | ディレクトリの同期（差分転送）            | 低     |
| 再開機能          | 中断した転送の再開                        | 低     |

### F-6: 接続テスト

| 機能           | 説明                                          | 優先度 |
| -------------- | --------------------------------------------- | ------ |
| 疎通確認       | 指定ホストへの SSH 接続可否をテスト           | 高     |
| 認証テスト     | 鍵/パスワードでの認証が成功するかテスト       | 高     |
| ステータス表示 | 各接続先のステータスをアイコンで表示（🟢/🔴） | 高     |
| レイテンシ表示 | 接続先への応答時間を表示                      | 中     |
| 一括テスト     | 登録済み接続先を一括でテスト                  | 低     |

## 画面構成

```
┌─────────────────────────────────────────────────────────────────┐
│  SSH Manager                                            [─][□][×]│
├──────────────┬──────────────────────────────────────────────────┤
│              │                                                  │
│  📁 接続先   │  ┌─ ターミナル ─────────────────────────────────┐│
│  ├── 🏠 Home │  │                                              ││
│  │   ├── PC2 │  │  user@server:~$ _                            ││
│  │   └── NAS │  │                                              ││
│  ├── ☁️ AWS  │  │                                              ││
│  │   ├── Prod│  └──────────────────────────────────────────────┘│
│  │   └── Dev │                                                  │
│  └── 🔧 VPS  │  ┌─ ファイル転送 ───────────────────────────────┐│
│      └── Srv │  │  ローカル          │  リモート              ││
│              │  │  📁 Documents      │  📁 /var/www           ││
│  ───────────│  │  📁 Downloads      │  📁 /home/user         ││
│  ⚙️ SSH設定  │  │  📄 file.txt       │  📄 config.yml         ││
│  🔑 鍵管理   │  └──────────────────────────────────────────────┘│
│              │                                                  │
└──────────────┴──────────────────────────────────────────────────┘
```

## 技術的検討事項

### 使用候補の Rust クレート

| 用途          | クレート            | 備考                                     |
| ------------- | ------------------- | ---------------------------------------- |
| SSH 接続      | `ssh2`              | libssh2 の Rust バインディング、実績あり |
| SSH 接続      | `russh`             | Pure Rust 実装、依存が少ない             |
| SFTP          | `ssh2`（SFTP 含む） | ssh2 に含まれる                          |
| ターミナル    | `portable-pty`      | 疑似端末の作成                           |
| ターミナル UI | `xterm.js`          | フロントエンドで使用（WebView 経由）     |
| Config 解析   | 自前実装            | SSH Config のパース                      |

### Tauri での実装方針

- **バックエンド（Rust）**: SSH 接続・ファイル転送処理、Config 解析
- **フロントエンド（Leptos）**: UI 表示、ユーザー操作
- **ターミナル**: `xterm.js`等の Web ベースターミナルを WebView 内で使用

## 実装フェーズ

### Phase 1: MVP（最小実装）

- [ ] SSH Config 読み込み・表示
- [ ] 接続先一覧表示
- [ ] 接続テスト（疎通確認）
- [ ] SSH キー一覧表示
- [ ] 公開鍵のコピー

### Phase 2: 基本機能

- [ ] SSH Config 編集（追加・編集・削除）
- [ ] SSH キー生成
- [ ] クイック接続（ターミナル統合）
- [ ] 基本的なファイル転送（アップロード・ダウンロード）

### Phase 3: 拡張機能

- [ ] マルチタブターミナル
- [ ] ファイル転送のドラッグ&ドロップ
- [ ] 転送キュー・進捗表示
- [ ] 接続履歴・お気に入り

### Phase 4: 高度な機能

- [ ] ディレクトリ同期
- [ ] コマンドスニペット
- [ ] 一括接続テスト
- [ ] 踏み台サーバー対応

## 受け入れ基準

- [ ] `~/.ssh/config` の読み込み・編集が GUI で行える
- [ ] SSH キーの一覧表示・生成・コピーができる
- [ ] 登録済み接続先にワンクリックで接続できる
- [ ] アプリ内ターミナルで SSH セッションを操作できる
- [ ] ファイルのアップロード・ダウンロードが GUI で行える
- [ ] 接続テストで接続可否を事前確認できる

## 関連ドキュメント

- 技術調査: `docs/02_research/2025_12/20251202_ssh_libraries.md`（作成予定）
- 実装計画: `docs/03_plans/ssh-manager/`（作成予定）

## メモ

- セキュリティ考慮: パスフレーズの安全な取り扱い（メモリ上での保持期間等）
- クロスプラットフォーム: macOS/Windows/Linux での動作確認が必要
- 既存ツールの参考: Termius, Cyberduck, WinSCP, iTerm2 等
